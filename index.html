<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ray's Rent Control Panel</title>
<style>
    body { font-family: Arial, sans-serif; background: #1e1e1e; color: #fff; padding: 20px; }
    h2 { color: #f0c040; }
    label, input, button { display: block; margin: 10px 0; }
    input { padding: 8px; width: 150px; }
    button { padding: 10px; cursor: pointer; }
    .status { margin: 10px 0; font-weight: bold; }
</style>
</head>
<body>

<h2>Ray's Rent Control Panel</h2>

<div class="status" id="status">Status: Not connected</div>

<label for="password">Enter Connection Code:</label>
<input type="password" id="password" placeholder="Type code here">

<button onclick="connect()">Connect</button>

<h3>Timer Controls</h3>

<div>
    <button onclick="sendCommand('add_time', {minutes:10})">Add 10 Minutes</button>
</div>

<div>
    <input type="number" id="minInput" placeholder="Minutes">
    <button onclick="setTime('minutes')">Set Minutes</button>
</div>

<div>
    <input type="number" id="hourInput" placeholder="Hours">
    <button onclick="setTime('hours')">Set Hours</button>
</div>

<div>
    <button onclick="sendCommand('set_money', {option:'250'})">💵 250 IQD → 1 Hour</button>
    <button onclick="sendCommand('set_money', {option:'500'})">💰 500 IQD → 3 Hours</button>
</div>

<div>
    <button onclick="sendCommand('pause')">⏸ Pause</button>
    <button onclick="sendCommand('unpause')">▶️ Unpause</button>
    <button onclick="sendCommand('reset')">🔁 Reset Timer</button>
</div>

<div>
    <h3>Timer Status</h3>
    <div id="timer">Time: --</div>
    <div id="pause_msg"></div>
</div>

<script>
let SERVER_IP = "http://192.168.0.107:5000"; // replace with your PC IP

let connected = false;

function connect() {
    let password = document.getElementById("password").value.trim();
    if(!password){
        alert("Please type the connection code!");
        return;
    }
    fetch(`${SERVER_IP}/verify`, {
        method: "POST",
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `password=${password}`
    })
    .then(res => res.json())
    .then(data => {
        if(data.status === "success") {
            connected = true;
            document.getElementById("status").innerText = "✅ Connected to Timer";
            startTimerUpdates();
        } else {
            document.getElementById("status").innerText = "❌ Wrong Code!";
        }
    })
    .catch(err => {
        document.getElementById("status").innerText = "⚠️ Cannot reach timer";
        console.error(err);
    });
}

function sendCommand(route, data={}) {
    if(!connected){
        alert("Please connect first!");
        return;
    }
    let formData = new URLSearchParams(data);
    fetch(`${SERVER_IP}/${route}`, {
        method: "POST",
        body: formData
    }).catch(err => console.error(err));
}

function setTime(mode){
    let data = {};
    if(mode === "minutes"){
        let mins = document.getElementById("minInput").value;
        if(mins) data.minutes = mins;
    } else if(mode === "hours"){
        let hrs = document.getElementById("hourInput").value;
        if(hrs) data.minutes = hrs*60;
    }
    sendCommand("set_time", data);
}

function startTimerUpdates(){
    setInterval(()=>{
        fetch(`${SERVER_IP}/get_remaining_time`)
        .then(res=>res.json())
        .then(data=>{
            document.getElementById("timer").innerText = "Time: "+data.remaining;
        }).catch(err=>{
            document.getElementById("status").innerText = "⚠️ Cannot reach timer";
        });

        fetch(`${SERVER_IP}/get_pause_requests`)
        .then(res=>res.json())
        .then(data=>{
            if(data.requests && data.requests.length>0){
                document.getElementById("pause_msg").innerText = "Pause request: "+data.requests.join(", ");
            }
        });
    }, 2000);
}
</script>

</body>
</html>
